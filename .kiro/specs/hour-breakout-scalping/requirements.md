# 需求文档

## 介绍

HourBreakout1是一个基于FreqTrade的多时间框架突破割头皮交易策略。该策略使用1分钟作为主时间周期，结合1小时和5分钟的参考时间框架，通过识别突破、回踩和反弹模式来捕获短期价格动量。

## 术语表

- **策略系统**: HourBreakout1交易策略实现
- **FreqTrade**: 开源加密货币交易机器人框架
- **时间周期**: 包括1分钟(1m)、5分钟(5m)、1小时(1h)的K线周期
- **突破形态**: 价格突破前期高点的技术形态
- **回踩形态**: 突破后价格回调到支撑位的技术形态
- **MA5**: 5周期移动平均线
- **超参数优化**: FreqTrade的HyperOpt超参数优化功能
- **配置文件**: FreqTrade策略配置文件

## 需求

### 需求 1: 多时间框架数据获取

**用户故事:** 作为交易策略，我需要获取多个时间框架的价格数据，以便进行多维度技术分析。

#### 验收标准

1. 策略系统 应当 访问1分钟K线数据作为主时间框架
2. 策略系统 应当 访问5分钟K线数据作为参考时间框架
3. 策略系统 应当 访问1小时K线数据作为参考时间框架
4. 当 访问多时间框架数据时，策略系统 应当 确保数据对齐和同步
5. 策略系统 应当 优雅地处理缺失或不完整的数据

### 需求 2: 突破条件识别

**用户故事:** 作为交易策略，我需要识别5分钟价格突破前1小时最高价的条件，以便确定潜在的入场机会。

#### 验收标准

1. 策略系统 应当 计算前1小时周期的最高价
2. 当 5分钟K线收盘时，策略系统 应当 将收盘价与1小时最高价进行比较
3. 如果 5分钟收盘价高于1小时最高价，那么 策略系统 应当 将突破条件标记为真
4. 策略系统 应当 维持突破状态直到入场条件满足或失效
5. 策略系统 应当 处理1小时数据不足的边界情况

### 需求 3: 回踩条件检测

**用户故事:** 作为交易策略，我需要检测突破后价格回踩到MA5的条件，以便寻找更好的入场点位。

#### 验收标准

1. 策略系统 应当 在1分钟时间框架上计算5周期移动平均线
2. 当 突破条件激活时，策略系统 应当 监控1分钟价格行为
3. 如果 1分钟K线收盘价等于或低于MA5，那么 策略系统 应当 将回踩条件标记为真
4. 如果 1分钟K线最低价触及或跌破MA5，那么 策略系统 应当 将回踩条件标记为真
5. 策略系统 应当 在突破条件失效时重置回踩条件

### 需求 4: 反弹入场信号

**用户故事:** 作为交易策略，我需要识别价格从MA5反弹的信号，以便执行做多入场。

#### 验收标准

1. 当 回踩条件为真时，策略系统 应当 监控价格恢复
2. 如果 回踩后1分钟K线收盘价高于MA5，那么 策略系统 应当 生成做多入场信号
3. 策略系统 应当 确保所有三个条件（突破、回踩、反弹）在入场前都满足
4. 策略系统 应当 根据风险管理规则验证入场信号
5. 策略系统 应当 防止同一突破形态的多次入场

### 需求 5: 止损机制

**用户故事:** 作为交易策略，我需要实现基于前1小时最高价的止损机制，以便控制下行风险。

#### 验收标准

1. 当 仓位开启时，策略系统 应当 将止损设置在前1小时最高价
2. 如果 1分钟K线收盘价低于1小时最高价，那么 策略系统 应当 触发止损出场
3. 策略系统 应当 在持仓期间形成新的1小时最高价时更新止损水平
4. 策略系统 应当 在止损计算中处理部分成交和仓位大小
5. 策略系统 应当 记录止损触发以供分析

### 需求 6: 时间止盈机制

**用户故事:** 作为交易策略，我需要实现基于持仓时间的止盈机制，以便锁定短期利润。

#### 验收标准

1. 策略系统 应当 定义可配置的时间参数N（以分钟为单位）用于止盈
2. 当 持仓时间达到N分钟时，策略系统 应当 触发止盈出场
3. 策略系统 应当 允许通过超参数优化来优化N参数
4. 策略系统 应当 在时间计算中处理时区和市场交易时间
5. 策略系统 应当 为不同的基于时间的出场策略提供灵活性

### 需求 7: FreqTrade集成

**用户故事:** 作为FreqTrade策略，我需要符合FreqTrade框架规范，以便能够正常运行和集成。

#### 验收标准

1. 策略系统 应当 继承IStrategy基类
2. 策略系统 应当 实现必需的方法：populate_indicators、populate_entry_trend、populate_exit_trend
3. 策略系统 应当 定义正确的时间框架和信息对配置
4. 策略系统 应当 处理FreqTrade的数据框结构和列命名约定
5. 策略系统 应当 使用FreqTrade的日志系统实现正确的日志记录

### 需求 8: 回测支持

**用户故事:** 作为交易策略，我需要支持历史数据回测，以便验证策略的历史表现。

#### 验收标准

1. 策略系统 应当 与FreqTrade的回测引擎兼容
2. 策略系统 应当 正确处理历史多时间框架数据
3. 策略系统 应当 在回测模式下产生准确的入场和出场信号
4. 策略系统 应当 支持回测中的不同市场条件和时间段
5. 策略系统 应当 提供详细的交易日志和性能指标

### 需求 9: 超参数优化

**用户故事:** 作为交易策略，我需要支持HyperOpt超参数优化，以便找到最佳参数组合。

#### 验收标准

1. 策略系统 应当 使用HyperOpt空间定义来定义可优化参数
2. 策略系统 应当 将基于时间的出场参数N包含为可优化参数
3. 策略系统 应当 将MA周期包含为可优化参数
4. 策略系统 应当 支持风险管理参数的优化
5. 策略系统 应当 处理参数验证和边界条件

### 需求 10: 配置文件生成

**用户故事:** 作为FreqTrade用户，我需要专门的配置文件，以便正确运行HourBreakout1策略。

#### 验收标准

1. 配置文件 应当 放置在configs目录中
2. 配置文件 应当 指定正确的时间框架和信息对
3. 配置文件 应当 包含适当的风险管理设置
4. 配置文件 应当 配置正确的交易所和市场设置
5. 配置文件 应当 包含策略特定参数及其默认值